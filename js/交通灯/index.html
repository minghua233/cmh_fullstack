<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style>
    div {
      background-color: grey;
      display: inline-block;
      margin: 30px;
      width: 100px;
      height: 100px;
      border-radius: 50px;
    }

    .green.light {
      background-color: green;
    }

    .yellow.light {
      background-color: yellow;
    }

    .red.light {
      background-color: red;
    }
  </style>
</head>

<body>
  <div class="green"></div>
  <div class="yellow"></div>
  <div class="red"></div>
  <script>
    function green() {
      var lights = document.getElementsByTagName("div");
      for (var i = 0; i < 3; i++) {
        lights[i].classList.remove("light")
      }
      document.querySelector('.green').classList.add('light')
    }

    function yellow() {
      var lights = document.getElementsByTagName("div");
      for (var i = 0; i < 3; i++) {
        lights[i].classList.remove("light")
      }
      document.querySelector('.yellow').classList.add('light')
    }

    function red() {
      var lights = document.getElementsByTagName("div");
      for (var i = 0; i < 3; i++) {
        lights[i].classList.remove("light")
      }
      document.querySelector('.red').classList.add('light')
    }

    // function light(time) {
    //   if (time > 4) return
    //   green()
    //   setTimeout(() => {
    //     yellow()
    //     setTimeout(() => {
    //       red()
    //       setTimeout(() => {
    //         console.log('done')
    //         light(time + 1)
    //       }, 3000)
    //     }, 2000)
    //   }, 1000)
    // }
    
    // light(0)

    let /*img = new Image(),*/
      url = 'https://yanxuan.nosdn.127.net/8ab9d7479cce3fb4517efc81f7f069d1.jpg?type=webp&imageView&quality=95&thumbnail=1920x420'
    // img.src = url
    // img.onload = function() {
    //   console.log(123);
    // }
    // let p1 = new Promise((resolve, reject) => {
    //   let img = new Image()
    //   img.src = url
    //   img.onload = function() {
    //     resolve()
    //   }
    //   img.onerror = function() {
    //     reject()
    //   }
    // })

    // p1.then(() => {
    //   console.log(123);
    // })

    let time = (t) => new Promise((resolve, reject) => {
      setTimeout(() => {
        resolve()
      }, t);
    })
    function light2() {
      green()
      // 1s
      time(1000)
      .then(() => {
        yellow() // 2s ->red
        return time(2000)
      })
      .then(() => {
        red()
        return time(3000)
      })
      .then(() => {
        console.log('ok');
      })
    }
    
    light2()

    // es7 acync + await
    async function light3() {
      green()
      await time(1000)  // 接在await之后的一条代码立即执行
      yellow() // await下一句延迟执行
      await time(2000)
      red()
      await time(3000)
    }
  </script>
</body>

</html>